<html>
	<head>
		<style>
			div {
				width: 200px;
				height: 100px;
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
			<div onmousemove="ratelimit(mousemove, event, 50)"></div>
			<form>
				<button id="open">Open</button>
				<button id="close">Close</button>
			</form>
			<div id="output"></div>
	<script>
			function mousemove(e) {
        		if (!ws) {
            		return;
        		}
      		console.log(JSON.stringify({
        		'action': 'move',
        		'x': e.pageX,
        		'y': e.pageY,
        		'w': window.innerWidth,
        		'h': window.innerHeight
      		}));
      		ws.send(JSON.stringify({
        		'action': 'move',
        		'x': e.pageX,
        		'y': e.pageY,
        		'w': window.innerWidth,
        		'h': window.innerHeight
      		}));
			};

			let last = +new Date();
			function ratelimit(f, e, time) {
				const now = +new Date();
				if (now - last > time) {
					last = now;
					f(e);
				}
			};

			var output = document.getElementById("output");
    		var ws;

    		var print = function(message) {
        		var d = document.createElement("div");
        		d.textContent = message;
        		output.appendChild(d);
    		};

    		document.getElementById("open").onclick = function(evt) {
        		if (ws) {
            		return false;
        		}
        		ws = new WebSocket("ws:\/\/localhost:8080\/echo");
        		ws.onopen = function(evt) {
            		print("OPEN");
        		}
        		ws.onclose = function(evt) {
            		print("CLOSE");
            		ws = null;
        		}
        		ws.onmessage = function(evt) {
            		print("RESPONSE: " + evt.data);
        		}
        		ws.onerror = function(evt) {
            		print("ERROR: " + evt.data);
        		}
        		return false;
    		};

    		document.getElementById("close").onclick = function(evt) {
        		if (!ws) {
            		return false;
        		}
        		ws.close();
        		return false;
    		};
	</script>
	</body>

</html>
